<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocumenTest</title>
    <script>
        let counter_1 = 0;
        function handleClick(event, id) {
            counter_1 += 1;
            document.getElementById(id).innerText = counter_1;
        }

        let mousePoint;
        let imgCenter;
        let max;

        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function handleMouseMove(event, id) {
            const img = document.getElementById(id)
            imgCenter = {
                x: img.getBoundingClientRect().x + img.getBoundingClientRect().width/2, 
                y: img.getBoundingClientRect().y + img.getBoundingClientRect().height/2
            }
            mousePoint = {
                x: event.clientX,
                y: event.clientY,
            }
            
            max = Math.max(Math.abs((imgCenter.x-mousePoint.x)/2), Math.abs((imgCenter.y-mousePoint.y)/2));

            img.style.boxShadow  = `${(imgCenter.x-mousePoint.x)/5}px ${(imgCenter.y-mousePoint.y)/5}px ${max}px ${color}`
        }

        let color = getRandomColor();
        let lastCall = Date.now()
        let previousCall = lastCall
        let lastCallTimer = null
        let colorChanger = null
        const timerMs = 500

        function handleMouseLeave(event, id) {
            const img = document.getElementById(id)

            clearInterval(colorChanger);

            if (previousCall && lastCall - previousCall <= timerMs) {
                clearTimeout(lastCallTimer)
            }
  
            let imgCenter = {
                x: img.getBoundingClientRect().x + img.getBoundingClientRect().width/2, 
                y: img.getBoundingClientRect().y + img.getBoundingClientRect().height/2
            }
            let mousePoint = {
                x: event.clientX,
                y: event.clientY,
            }

            img.style.transition  = `box-shadow 0.5s ease`
            img.style.boxShadow  = `${(imgCenter.x-mousePoint.x)/10}px ${(imgCenter.y-mousePoint.y)/10}px 20px transparent`
            lastCallTimer = setTimeout(() => {
                img.style.transition  = `all 0s ease`
            }
            , timerMs);
        }

        function handleMouseEnter(event, id) {
            const img = document.getElementById(id)

            colorChanger = setInterval(() => {
                color = getRandomColor()
                img.style.boxShadow = `${(imgCenter.x-mousePoint.x)/10}px ${(imgCenter.y-mousePoint.y)/10}px ${max}px ${color}`
            }, 500)

            if (previousCall && lastCall - previousCall <= timerMs) {
                clearTimeout(lastCallTimer)
            }
  
            img.style.transition  = `box-shadow 0.5s ease`
            lastCallTimer = setTimeout(() =>
                img.style.transition  = `all 0s ease`
            , timerMs);
        }
    </script>
</head>

<body>
    <div class="app">
        <header>header</header>
        <div class="app__content">
            <table>
                <thead>
                    <tr>
                        <th colspan="2">The table header</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>The table body</td>
                        <td>with two columns</td>
                    </tr>
                </tbody>
            </table>
            <button onclick="handleClick(event, 'counter_1')">click me!</button>
            <h1>Count: 
                <span id="counter_1">0</span>
            </h1>
            <img class="img" 
            id="aster__img" 
            src="img/aster.jpg" 
            alt=""
            onmousemove="handleMouseMove(event, 'aster__img')"
            onmouseleave="handleMouseLeave(event, 'aster__img')"
            onmouseenter="handleMouseEnter(event, 'aster__img')"
            >
        </div>
    </div>
</body>
</html>